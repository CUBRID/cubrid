image:
  - Visual Studio 2017

environment:
  CMAKE_GENERATOR: "Visual Studio 15 2017 Win64"
  BUILD_TYPE: RelWithDebInfo

matrix:
  fast_finish: true

install:
  - cinst ant -i

  # cinst is an executable from chocolatey (a package manager for Windows) used to install packages
  # Chocolatey automatically shims executables in package folders that are not explicitly ignored, putting them into
  # the "$($env:ChocolateyInstall)\bin" folder. Therefore FindFLEX (cmake function) finds the shim executable and not
  # the original one. In order to make cmake happy we need to exclude win_flex.exe & win_bison.exe from shimming.
  # For more details please see: https://chocolatey.org/docs/features-shim#i-need-to-exclude-a-file-from-shimming
  - ps: Set-Variable -Name "winflexbison3_install_dir" -Value $env:ChocolateyInstall\lib\winflexbison3\tools
  - ps: New-Item -ItemType Directory -Force -Path $winflexbison3_install_dir | Out-Null
  - ps: New-Item -Path $winflexbison3_install_dir -Name win_flex.exe.ignore -type file -force | Out-Null
  - ps: New-Item -Path $winflexbison3_install_dir -Name win_bison.exe.ignore -type file -force | Out-Null
  - ps: $env:Path += ";$winflexbison3_install_dir"
  - cinst winflexbison3 -i

build_script:
  - cmake -E make_directory build
  - cmake -E chdir build cmake -G "%CMAKE_GENERATOR%" -DCMAKE_BUILD_TYPE=%BUILD_TYPE% ..
  - cmake --build build --config %BUILD_TYPE%
