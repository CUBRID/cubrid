image:
  - Visual Studio 2017

environment:
  CMAKE_GENERATOR: "Visual Studio 15 2017 Win64"
  BUILD_TYPE: RelWithDebInfo

matrix:
  fast_finish: true

install:
  - ps: Set-Variable -Name "winflexbison3_install_dir" -Value $env:ChocolateyInstall\lib\winflexbison3\tools
  - ps: New-Item -ItemType Directory -Force -Path $winflexbison3_install_dir | Out-Null
  - ps: New-Item -Path $winflexbison3_install_dir -Name win_flex.exe.ignore -type file -force | Out-Null
  - ps: New-Item -Path $winflexbison3_install_dir -Name win_bison.exe.ignore -type file -force | Out-Null
  - ps: $env:Path += ";$winflexbison3_install_dir"
  - cinst ant -i
  - cinst winflexbison3 -i

build_script:
  - cmake -E make_directory build
  - cmake -E chdir build cmake -G "%CMAKE_GENERATOR%" -DCMAKE_BUILD_TYPE=%BUILD_TYPE% ..
  - cmake --build build --config %BUILD_TYPE%
